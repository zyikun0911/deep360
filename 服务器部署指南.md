# ğŸš€ Deep360 æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²ä¿¡æ¯

- **æœåŠ¡å™¨ IP**: 74.208.61.148
- **æœåŠ¡å™¨è·¯å¾„**: /opt/messenger360/
- **GitHub ä»“åº“**: https://github.com/zyikun0911/deep360

## ğŸ¯ éƒ¨ç½²æ–¹å¼

### æ–¹å¼ä¸€ï¼šè‡ªåŠ¨éƒ¨ç½²ï¼ˆæ¨èï¼‰

è¿è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ï¼š

```powershell
powershell -ExecutionPolicy Bypass -File deploy-to-server.ps1
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²

#### 1. åˆ›å»ºéƒ¨ç½²åŒ…

```powershell
# åˆ›å»ºéƒ¨ç½²ç›®å½•
mkdir deploy-package
cd deploy-package

# å¤åˆ¶å¿…è¦æ–‡ä»¶
Copy-Item ..\package.json .
Copy-Item ..\server.js .
Copy-Item ..\start.js .
Copy-Item ..\healthcheck.js .
Copy-Item ..\Dockerfile .
Copy-Item ..\docker-compose.yml .
Copy-Item ..\env.example .

# å¤åˆ¶ç›®å½•
Copy-Item ..\routes . -Recurse
Copy-Item ..\services . -Recurse
Copy-Item ..\models . -Recurse
Copy-Item ..\middleware . -Recurse
Copy-Item ..\utils . -Recurse
Copy-Item ..\plugins . -Recurse
Copy-Item ..\frontend . -Recurse
Copy-Item ..\scripts . -Recurse
Copy-Item ..\config . -Recurse

# åˆ›å»ºå‹ç¼©åŒ…
Compress-Archive -Path * -DestinationPath ..\deep360-deploy.zip
```

#### 2. ä¸Šä¼ åˆ°æœåŠ¡å™¨

```bash
# ä¸Šä¼ æ–‡ä»¶
scp deep360-deploy.zip root@74.208.61.148:/tmp/

# ç™»å½•æœåŠ¡å™¨
ssh root@74.208.61.148
```

#### 3. åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²

```bash
# è¿›å…¥ä¸´æ—¶ç›®å½•
cd /tmp

# è§£å‹æ–‡ä»¶
unzip deep360-deploy.zip -d deep360-deploy/
cd deep360-deploy

# åˆ›å»ºå¤‡ä»½
BACKUP_DIR="/root/backup_$(date +%Y%m%d_%H%M%S)"
mkdir -p $BACKUP_DIR
if [ -d "/opt/messenger360" ]; then
    cp -r /opt/messenger360 $BACKUP_DIR/
fi

# åœæ­¢ç°æœ‰æœåŠ¡
pm2 stop all || true
systemctl stop nginx || true

# éƒ¨ç½²æ–°ä»£ç 
rm -rf /opt/messenger360/*
cp -r * /opt/messenger360/
cd /opt/messenger360

# å®‰è£…ä¾èµ–
npm install --production

# æ„å»ºå‰ç«¯
cd frontend
npm install
npm run build
cd ..

# é…ç½®ç¯å¢ƒå˜é‡
if [ ! -f ".env" ]; then
    cp env.example .env
fi

# å¯åŠ¨æœåŠ¡
pm2 start server.js --name deep360-api
pm2 save

# å¯åŠ¨ Nginx
systemctl start nginx

# å¥åº·æ£€æŸ¥
sleep 5
curl -f http://localhost:7788/health || echo "âš ï¸ å¥åº·æ£€æŸ¥å¤±è´¥"

echo "âœ… éƒ¨ç½²å®Œæˆï¼"
echo "ğŸŒ è®¿é—®åœ°å€: http://74.208.61.148"
```

## ğŸ”§ éƒ¨ç½²é…ç½®

### ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
# åº”ç”¨é…ç½®
NODE_ENV=production
PORT=7788

# æ•°æ®åº“é…ç½®
MONGODB_URI=mongodb://localhost:27017/deep360
REDIS_URL=redis://localhost:6379

# JWT é…ç½®
JWT_SECRET=your-production-jwt-secret

# å…¶ä»–é…ç½®...
```

### PM2 é…ç½®

åˆ›å»º `ecosystem.config.js`ï¼š

```javascript
module.exports = {
  apps: [{
    name: 'deep360-api',
    script: 'server.js',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G',
    env: {
      NODE_ENV: 'production',
      PORT: 7788
    }
  }]
};
```

### Nginx é…ç½®

```nginx
server {
    listen 80;
    server_name 74.208.61.148;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /opt/messenger360/frontend/dist;
        try_files $uri $uri/ /index.html;
    }
    
    # API ä»£ç†
    location /api/ {
        proxy_pass http://localhost:7788/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
    
    # WebSocket ä»£ç†
    location /socket.io/ {
        proxy_pass http://localhost:7788;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
    }
}
```

## ğŸ“Š éƒ¨ç½²éªŒè¯

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥ PM2 è¿›ç¨‹
pm2 list

# æ£€æŸ¥ç«¯å£
netstat -tlnp | grep :7788

# æ£€æŸ¥ Nginx
systemctl status nginx
```

### 2. å¥åº·æ£€æŸ¥

```bash
# API å¥åº·æ£€æŸ¥
curl http://localhost:7788/health

# å‰ç«¯è®¿é—®
curl http://localhost:80
```

### 3. æ—¥å¿—æ£€æŸ¥

```bash
# PM2 æ—¥å¿—
pm2 logs deep360-api

# Nginx æ—¥å¿—
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log
```

## ğŸ›¡ï¸ å®‰å…¨é…ç½®

### 1. é˜²ç«å¢™é…ç½®

```bash
# å¼€æ”¾å¿…è¦ç«¯å£
ufw allow 80
ufw allow 443
ufw allow 22
ufw enable
```

### 2. SSL è¯ä¹¦ï¼ˆå¯é€‰ï¼‰

```bash
# å®‰è£… Certbot
apt install certbot python3-certbot-nginx

# è·å– SSL è¯ä¹¦
certbot --nginx -d your-domain.com
```

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### è‡ªåŠ¨æ›´æ–°

```bash
# ä» GitHub æ‹‰å–æœ€æ–°ä»£ç 
cd /opt/messenger360
git pull origin main

# é‡å¯æœåŠ¡
pm2 restart deep360-api
```

### æ‰‹åŠ¨æ›´æ–°

```bash
# åœæ­¢æœåŠ¡
pm2 stop deep360-api

# æ›´æ–°ä»£ç 
# ... å¤åˆ¶æ–°æ–‡ä»¶ ...

# å®‰è£…ä¾èµ–
npm install --production

# æ„å»ºå‰ç«¯
cd frontend && npm run build && cd ..

# é‡å¯æœåŠ¡
pm2 start deep360-api
```

## ğŸ“ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£è¢«å ç”¨**
   ```bash
   lsof -i :7788
   kill -9 <PID>
   ```

2. **æƒé™é—®é¢˜**
   ```bash
   chown -R www-data:www-data /opt/messenger360
   chmod -R 755 /opt/messenger360
   ```

3. **å†…å­˜ä¸è¶³**
   ```bash
   # å¢åŠ  swap
   fallocate -l 2G /swapfile
   chmod 600 /swapfile
   mkswap /swapfile
   swapon /swapfile
   ```

4. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥ MongoDB
   systemctl status mongod
   
   # æ£€æŸ¥ Redis
   systemctl status redis
   ```

## ğŸ‰ éƒ¨ç½²å®Œæˆ

éƒ¨ç½²æˆåŠŸåï¼Œæ‚¨å¯ä»¥è®¿é—®ï¼š

- **å‰ç«¯ç•Œé¢**: http://74.208.61.148
- **API æ–‡æ¡£**: http://74.208.61.148/api/docs
- **å¥åº·æ£€æŸ¥**: http://74.208.61.148/health

---

**ğŸš€ Deep360 ç³»ç»Ÿå·²æˆåŠŸéƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼**
