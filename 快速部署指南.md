# 🚀 Deep360 GitHub Webhook 快速部署指南

## 📋 部署信息
- **服务器 IP**: 74.208.61.148
- **GitHub 仓库**: zyikun0911/deep360
- **Webhook 密钥**: deep360-secret-1234

## 🔧 步骤 1: 上传配置文件

在您的终端中执行以下命令：

```bash
# 上传 Webhook 配置文件
scp webhook-server.js root@74.208.61.148:/opt/messenger360/
scp webhook-receiver.sh root@74.208.61.148:/opt/messenger360/
scp nginx-deep360.conf root@74.208.61.148:/etc/nginx/sites-available/deep360
```

## 🔧 步骤 2: 配置服务器

登录服务器并执行配置：

```bash
# 登录服务器
ssh root@74.208.61.148

# 进入项目目录
cd /opt/messenger360

# 设置权限
chmod +x webhook-receiver.sh

# 创建日志目录
mkdir -p /var/log
touch /var/log/deep360-webhook.log
chmod 666 /var/log/deep360-webhook.log

# 配置 Nginx
ln -sf /etc/nginx/sites-available/deep360 /etc/nginx/sites-enabled/
nginx -t
systemctl reload nginx

# 启动 Webhook 服务器
pm2 start webhook-server.js --name deep360-webhook
pm2 save

# 检查服务状态
pm2 list
```

## 🔧 步骤 3: 配置 GitHub Webhook

1. **访问 GitHub 仓库设置**:
   - 打开: https://github.com/zyikun0911/deep360/settings/hooks
   - 点击 "Add webhook"

2. **配置 Webhook 参数**:
   - **Payload URL**: `http://74.208.61.148/webhook`
   - **Content type**: `application/json`
   - **Secret**: `deep360-secret-1234`
   - **Events**: 选择 "Just the push event"
   - 点击 "Add webhook"

## 🔧 步骤 4: 测试自动部署

```bash
# 推送测试代码
git add .
git commit -m "测试自动部署"
git push origin main

# 查看部署日志
ssh root@74.208.61.148 "tail -f /var/log/deep360-webhook.log"
```

## 📊 监控命令

```bash
# 查看 Webhook 日志
ssh root@74.208.61.148 "tail -f /var/log/deep360-webhook.log"

# 检查服务状态
ssh root@74.208.61.148 "pm2 status"

# 健康检查
ssh root@74.208.61.148 "curl -f http://localhost:7788/health"
```

## 🎯 一键部署脚本

如果您想一次性执行所有命令，可以复制以下脚本：

```bash
#!/bin/bash
# Deep360 一键部署脚本

SERVER_IP="74.208.61.148"

echo "🚀 开始部署 Deep360 GitHub Webhook..."

# 1. 上传配置文件
echo "📤 上传配置文件..."
scp webhook-server.js root@$SERVER_IP:/opt/messenger360/
scp webhook-receiver.sh root@$SERVER_IP:/opt/messenger360/
scp nginx-deep360.conf root@$SERVER_IP:/etc/nginx/sites-available/deep360

# 2. 配置服务器
echo "🔧 配置服务器..."
ssh root@$SERVER_IP << 'EOF'
cd /opt/messenger360
chmod +x webhook-receiver.sh
mkdir -p /var/log
touch /var/log/deep360-webhook.log
chmod 666 /var/log/deep360-webhook.log
ln -sf /etc/nginx/sites-available/deep360 /etc/nginx/sites-enabled/
nginx -t && systemctl reload nginx
pm2 start webhook-server.js --name deep360-webhook
pm2 save
echo "✅ 服务器配置完成"
EOF

echo "✅ 部署完成！"
echo ""
echo "📋 下一步："
echo "1. 访问 https://github.com/zyikun0911/deep360/settings/hooks"
echo "2. 配置 Webhook: http://74.208.61.148/webhook"
echo "3. 测试推送: git push origin main"
```

## 🎉 完成！

部署完成后，当您推送代码到 GitHub 时，服务器会自动：
1. 接收 Webhook 通知
2. 验证请求安全性
3. 拉取最新代码
4. 重新构建应用
5. 重启服务
6. 验证部署成功

**现在您可以享受完全自动化的开发部署流程！** 🚀
