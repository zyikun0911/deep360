# ğŸš€ Deep360 GitHub Webhook å®Œæ•´éƒ¨ç½²æ­¥éª¤

## ğŸ“‹ éƒ¨ç½²ä¿¡æ¯
- **æœåŠ¡å™¨ IP**: 74.208.61.148
- **GitHub ä»“åº“**: zyikun0911/deep360
- **Webhook å¯†é’¥**: deep360-secret-1234

## ğŸ”§ æ­¥éª¤ 1: æ‰‹åŠ¨ä¸Šä¼ é…ç½®æ–‡ä»¶

åœ¨æ‚¨çš„ç»ˆç«¯ä¸­ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# ä¸Šä¼  Webhook æœåŠ¡å™¨æ–‡ä»¶
scp webhook-server.js root@74.208.61.148:/opt/messenger360/

# ä¸Šä¼  Webhook æ¥æ”¶å™¨è„šæœ¬
scp webhook-receiver.sh root@74.208.61.148:/opt/messenger360/

# ä¸Šä¼  Nginx é…ç½®æ–‡ä»¶
scp nginx-deep360.conf root@74.208.61.148:/etc/nginx/sites-available/deep360
```

## ğŸ”§ æ­¥éª¤ 2: ç™»å½•æœåŠ¡å™¨é…ç½®

```bash
# ç™»å½•æœåŠ¡å™¨
ssh root@74.208.61.148

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /opt/messenger360

# è®¾ç½®è„šæœ¬æƒé™
chmod +x webhook-receiver.sh

# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p /var/log
touch /var/log/deep360-webhook.log
chmod 666 /var/log/deep360-webhook.log

# é…ç½® Nginx
ln -sf /etc/nginx/sites-available/deep360 /etc/nginx/sites-enabled/
nginx -t
systemctl reload nginx

# å¯åŠ¨ Webhook æœåŠ¡å™¨
pm2 start webhook-server.js --name deep360-webhook
pm2 save

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 list
```

## ğŸ”§ æ­¥éª¤ 3: é…ç½® GitHub Webhook

1. **è®¿é—® GitHub ä»“åº“è®¾ç½®**:
   - æ‰“å¼€æµè§ˆå™¨è®¿é—®: https://github.com/zyikun0911/deep360/settings/hooks
   - ç‚¹å‡» "Add webhook" æŒ‰é’®

2. **é…ç½® Webhook å‚æ•°**:
   - **Payload URL**: `http://74.208.61.148/webhook`
   - **Content type**: `application/json`
   - **Secret**: `deep360-secret-1234`
   - **Events**: é€‰æ‹© "Just the push event"
   - ç‚¹å‡» "Add webhook"

## ğŸ”§ æ­¥éª¤ 4: æµ‹è¯•è‡ªåŠ¨éƒ¨ç½²

```bash
# æ¨é€æµ‹è¯•ä»£ç 
git add .
git commit -m "æµ‹è¯•è‡ªåŠ¨éƒ¨ç½²"
git push origin main

# æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
ssh root@74.208.61.148 "tail -f /var/log/deep360-webhook.log"
```

## ğŸ“Š ç›‘æ§å‘½ä»¤

```bash
# æŸ¥çœ‹ Webhook æ—¥å¿—
ssh root@74.208.61.148 "tail -f /var/log/deep360-webhook.log"

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
ssh root@74.208.61.148 "pm2 status"

# å¥åº·æ£€æŸ¥
ssh root@74.208.61.148 "curl -f http://localhost:7788/health"
```

## ğŸ¯ ä¸€é”®æ‰§è¡Œè„šæœ¬

å¦‚æœæ‚¨æƒ³ä¸€æ¬¡æ€§æ‰§è¡Œæ‰€æœ‰æœåŠ¡å™¨é…ç½®å‘½ä»¤ï¼Œå¯ä»¥å¤åˆ¶ä»¥ä¸‹å†…å®¹åˆ°æœåŠ¡å™¨ï¼š

```bash
#!/bin/bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /opt/messenger360

# è®¾ç½®è„šæœ¬æƒé™
chmod +x webhook-receiver.sh

# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p /var/log
touch /var/log/deep360-webhook.log
chmod 666 /var/log/deep360-webhook.log

# é…ç½® Nginx
ln -sf /etc/nginx/sites-available/deep360 /etc/nginx/sites-enabled/
nginx -t && systemctl reload nginx

# å¯åŠ¨ Webhook æœåŠ¡å™¨
pm2 start webhook-server.js --name deep360-webhook
pm2 save

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 list

echo "âœ… æœåŠ¡å™¨é…ç½®å®Œæˆï¼"
```

## ğŸ‰ å®Œæˆï¼

éƒ¨ç½²å®Œæˆåï¼Œå½“æ‚¨æ¨é€ä»£ç åˆ° GitHub æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨ï¼š

1. **æ¥æ”¶ Webhook é€šçŸ¥** - GitHub å‘é€æ¨é€äº‹ä»¶
2. **éªŒè¯è¯·æ±‚å®‰å…¨æ€§** - ä½¿ç”¨ HMAC-SHA256 ç­¾åéªŒè¯
3. **æ‹‰å–æœ€æ–°ä»£ç ** - ä» GitHub è‡ªåŠ¨æ‹‰å–
4. **é‡æ–°æ„å»ºåº”ç”¨** - å®‰è£…ä¾èµ–å¹¶æ„å»ºå‰ç«¯
5. **é‡å¯æœåŠ¡** - ä½¿ç”¨ PM2 é‡å¯åº”ç”¨
6. **éªŒè¯éƒ¨ç½²æˆåŠŸ** - å¥åº·æ£€æŸ¥ç¡®è®¤æœåŠ¡æ­£å¸¸

**ç°åœ¨æ‚¨å¯ä»¥äº«å—å®Œå…¨è‡ªåŠ¨åŒ–çš„å¼€å‘éƒ¨ç½²æµç¨‹ï¼** ğŸš€

## ğŸ“ æ•…éšœæ’é™¤

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **SSH è¿æ¥**: ç¡®ä¿å¯ä»¥æ­£å¸¸è¿æ¥æœåŠ¡å™¨
2. **æ–‡ä»¶æƒé™**: ç¡®ä¿ webhook-receiver.sh æœ‰æ‰§è¡Œæƒé™
3. **æœåŠ¡çŠ¶æ€**: ä½¿ç”¨ `pm2 status` æ£€æŸ¥æœåŠ¡çŠ¶æ€
4. **æ—¥å¿—æŸ¥çœ‹**: ä½¿ç”¨ `tail -f /var/log/deep360-webhook.log` æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
5. **Nginx é…ç½®**: ä½¿ç”¨ `nginx -t` æ£€æŸ¥é…ç½®è¯­æ³•
