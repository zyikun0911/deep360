nohup: ignoring input
info: 🚀 正在启动 Deep360 系统... {"service":"deep360-saas","timestamp":"2025-08-09T19:45:42.461Z"}
info: 📦 连接数据库... {"service":"deep360-saas","timestamp":"2025-08-09T19:45:42.463Z"}
(node:17568) [MONGOOSE] Warning: `errors` is a reserved schema pathname and may break some functionality. You are allowed to use it, but use at your own risk. To disable this warning pass `suppressReservedKeysWarning` as a schema option.
(Use `node --trace-warnings ...` to show where the warning was created)
19:45:47 [31merror[39m: 数据库连接失败: connect ECONNREFUSED 127.0.0.1:27017 {
  "module": "Database",
  "reason": {
    "type": "Unknown",
    "servers": {},
    "stale": false,
    "compatible": true,
    "heartbeatFrequencyMS": 10000,
    "localThresholdMS": 15,
    "setName": null,
    "maxElectionId": null,
    "maxSetVersion": null,
    "commonWireVersion": 0,
    "logicalSessionTimeoutMinutes": null
  }
}
warn: 连接外部 MongoDB 失败，尝试使用内存数据库运行 {"service":"deep360-saas","timestamp":"2025-08-09T19:45:47.477Z"}
info: 已切换到内存 MongoDB 运行 {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.192Z"}
info: 🔴 连接Redis... {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.192Z"}
info: Redis 连接成功 {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.196Z"}
info: ⚙️ 初始化服务... {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.197Z"}
info: 任务队列初始化完成 {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.204Z"}
info: 初始化插件管理器... {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.204Z"}
info: 插件管理器初始化完成 {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.215Z"}
info: 初始化插件市场服务... {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.215Z"}
error: 加载市场插件失败 /workspace/plugins/marketplace/whatsapp-auto-reply: Bad control character in string literal in JSON at position 553 (line 21 column 4) {"service":"deep360-saas","stack":"SyntaxError: Bad control character in string literal in JSON at position 553 (line 21 column 4)\n    at JSON.parse (<anonymous>)\n    at MarketplaceService.loadMarketplacePlugin (/workspace/services/marketplaceService.js:71:29)\n    at async MarketplaceService.loadLocalMarketplace (/workspace/services/marketplaceService.js:53:11)\n    at async MarketplaceService.initialize (/workspace/services/marketplaceService.js:25:7)\n    at async startServer (/workspace/server.js:279:7)","timestamp":"2025-08-09T19:45:48.217Z"}
info: 加载本地市场插件: 3 个 {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.218Z"}
warn: 未配置市场API密钥，跳过远程同步 {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.218Z"}
info: 加载推荐插件: 3 个 {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.218Z"}
info: 插件市场服务初始化完成 {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.218Z"}
19:45:48 [31merror[39m: 账号隔离服务初始化失败: {
  "module": "AccountIsolation"
}
warn: ⚠️ 部分服务初始化失败，但系统可以继续运行: {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.219Z"}
info: ⏰ 启动任务调度器... {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.219Z"}
info: 任务处理器注册完成 {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.219Z"}
info: 定时任务扫描器已启动 {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.221Z"}
info: 任务调度器启动成功 {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.239Z"}
info: 🚀 Deep360 SaaS 平台启动成功 {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.239Z"}
info: 📱 群控系统运行在端口 3000 {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.239Z"}
info: 🌐 访问地址: http://localhost:3000 {"service":"deep360-saas","timestamp":"2025-08-09T19:45:48.239Z"}
info: 队列统计: {"ai_content":{"active":0,"completed":0,"failed":0,"waiting":0},"auto_reply":{"active":0,"completed":0,"failed":0,"waiting":0},"bulk_message":{"active":0,"completed":0,"failed":0,"waiting":0},"contact_add":{"active":0,"completed":0,"failed":0,"waiting":0},"content_scrape":{"active":0,"completed":0,"failed":0,"waiting":0},"data_export":{"active":0,"completed":0,"failed":0,"waiting":0},"group_create":{"active":0,"completed":0,"failed":0,"waiting":0},"group_invite":{"active":0,"completed":0,"failed":0,"waiting":0},"group_kick":{"active":0,"completed":0,"failed":0,"waiting":0},"service":"deep360-saas","timestamp":"2025-08-09T19:46:48.253Z"}
info: 队列统计: {"ai_content":{"active":0,"completed":0,"failed":0,"waiting":0},"auto_reply":{"active":0,"completed":0,"failed":0,"waiting":0},"bulk_message":{"active":0,"completed":0,"failed":0,"waiting":0},"contact_add":{"active":0,"completed":0,"failed":0,"waiting":0},"content_scrape":{"active":0,"completed":0,"failed":0,"waiting":0},"data_export":{"active":0,"completed":0,"failed":0,"waiting":0},"group_create":{"active":0,"completed":0,"failed":0,"waiting":0},"group_invite":{"active":0,"completed":0,"failed":0,"waiting":0},"group_kick":{"active":0,"completed":0,"failed":0,"waiting":0},"service":"deep360-saas","timestamp":"2025-08-09T19:47:48.255Z"}
info: 队列统计: {"ai_content":{"active":0,"completed":0,"failed":0,"waiting":0},"auto_reply":{"active":0,"completed":0,"failed":0,"waiting":0},"bulk_message":{"active":0,"completed":0,"failed":0,"waiting":0},"contact_add":{"active":0,"completed":0,"failed":0,"waiting":0},"content_scrape":{"active":0,"completed":0,"failed":0,"waiting":0},"data_export":{"active":0,"completed":0,"failed":0,"waiting":0},"group_create":{"active":0,"completed":0,"failed":0,"waiting":0},"group_invite":{"active":0,"completed":0,"failed":0,"waiting":0},"group_kick":{"active":0,"completed":0,"failed":0,"waiting":0},"service":"deep360-saas","timestamp":"2025-08-09T19:48:48.248Z"}
info: 队列统计: {"ai_content":{"active":0,"completed":0,"failed":0,"waiting":0},"auto_reply":{"active":0,"completed":0,"failed":0,"waiting":0},"bulk_message":{"active":0,"completed":0,"failed":0,"waiting":0},"contact_add":{"active":0,"completed":0,"failed":0,"waiting":0},"content_scrape":{"active":0,"completed":0,"failed":0,"waiting":0},"data_export":{"active":0,"completed":0,"failed":0,"waiting":0},"group_create":{"active":0,"completed":0,"failed":0,"waiting":0},"group_invite":{"active":0,"completed":0,"failed":0,"waiting":0},"group_kick":{"active":0,"completed":0,"failed":0,"waiting":0},"service":"deep360-saas","timestamp":"2025-08-09T19:49:48.256Z"}
info: 队列统计: {"ai_content":{"active":0,"completed":0,"failed":0,"waiting":0},"auto_reply":{"active":0,"completed":0,"failed":0,"waiting":0},"bulk_message":{"active":0,"completed":0,"failed":0,"waiting":0},"contact_add":{"active":0,"completed":0,"failed":0,"waiting":0},"content_scrape":{"active":0,"completed":0,"failed":0,"waiting":0},"data_export":{"active":0,"completed":0,"failed":0,"waiting":0},"group_create":{"active":0,"completed":0,"failed":0,"waiting":0},"group_invite":{"active":0,"completed":0,"failed":0,"waiting":0},"group_kick":{"active":0,"completed":0,"failed":0,"waiting":0},"service":"deep360-saas","timestamp":"2025-08-09T19:50:48.248Z"}
info: 队列统计: {"ai_content":{"active":0,"completed":0,"failed":0,"waiting":0},"auto_reply":{"active":0,"completed":0,"failed":0,"waiting":0},"bulk_message":{"active":0,"completed":0,"failed":0,"waiting":0},"contact_add":{"active":0,"completed":0,"failed":0,"waiting":0},"content_scrape":{"active":0,"completed":0,"failed":0,"waiting":0},"data_export":{"active":0,"completed":0,"failed":0,"waiting":0},"group_create":{"active":0,"completed":0,"failed":0,"waiting":0},"group_invite":{"active":0,"completed":0,"failed":0,"waiting":0},"group_kick":{"active":0,"completed":0,"failed":0,"waiting":0},"service":"deep360-saas","timestamp":"2025-08-09T19:51:48.250Z"}
error: 服务器错误: Expected property name or '}' in JSON at position 1 (line 1 column 2) {"body":"{\\\"email\\\":\\\"test@example.com\\\",\\\"password\\\":\\\"password123\\\"}","expose":true,"service":"deep360-saas","stack":"SyntaxError: Expected property name or '}' in JSON at position 1 (line 1 column 2)\n    at JSON.parse (<anonymous>)\n    at parse (/workspace/node_modules/body-parser/lib/types/json.js:92:19)\n    at /workspace/node_modules/body-parser/lib/read.js:128:18\n    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n    at invokeCallback (/workspace/node_modules/raw-body/index.js:238:16)\n    at done (/workspace/node_modules/raw-body/index.js:227:7)\n    at IncomingMessage.onEnd (/workspace/node_modules/raw-body/index.js:287:7)\n    at IncomingMessage.emit (node:events:518:28)\n    at endReadableNT (node:internal/streams/readable:1698:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)","status":400,"statusCode":400,"timestamp":"2025-08-09T19:51:54.441Z","type":"entity.parse.failed"}
认证中间件错误: JsonWebTokenError: jwt malformed
    at module.exports [as verify] (/workspace/node_modules/jsonwebtoken/verify.js:70:17)
    at authMiddleware (/workspace/middleware/auth.js:31:25)
    at Layer.handle [as handle_request] (/workspace/node_modules/express/lib/router/layer.js:95:5)
    at next (/workspace/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/workspace/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/workspace/node_modules/express/lib/router/layer.js:95:5)
    at /workspace/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/workspace/node_modules/express/lib/router/index.js:346:12)
    at next (/workspace/node_modules/express/lib/router/index.js:280:10)
    at Function.handle (/workspace/node_modules/express/lib/router/index.js:175:3)
    at router (/workspace/node_modules/express/lib/router/index.js:47:12)
    at Layer.handle [as handle_request] (/workspace/node_modules/express/lib/router/layer.js:95:5)
    at trim_prefix (/workspace/node_modules/express/lib/router/index.js:328:13)
    at /workspace/node_modules/express/lib/router/index.js:286:9
    at Function.process_params (/workspace/node_modules/express/lib/router/index.js:346:12)
    at next (/workspace/node_modules/express/lib/router/index.js:280:10)
error: 服务器错误: Expected property name or '}' in JSON at position 1 (line 1 column 2) {"body":"{\\\"email\\\":\\\"test@example.com\\\",\\\"password\\\":\\\"password123\\\"}","expose":true,"service":"deep360-saas","stack":"SyntaxError: Expected property name or '}' in JSON at position 1 (line 1 column 2)\n    at JSON.parse (<anonymous>)\n    at parse (/workspace/node_modules/body-parser/lib/types/json.js:92:19)\n    at /workspace/node_modules/body-parser/lib/read.js:128:18\n    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n    at invokeCallback (/workspace/node_modules/raw-body/index.js:238:16)\n    at done (/workspace/node_modules/raw-body/index.js:227:7)\n    at IncomingMessage.onEnd (/workspace/node_modules/raw-body/index.js:287:7)\n    at IncomingMessage.emit (node:events:518:28)\n    at endReadableNT (node:internal/streams/readable:1698:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)","status":400,"statusCode":400,"timestamp":"2025-08-09T19:52:08.074Z","type":"entity.parse.failed"}
error: 服务器错误: Expected property name or '}' in JSON at position 1 (line 1 column 2) {"body":"{\\\"email\\\":\\\"test@example.com\\\",\\\"password\\\":\\\"password123\\\"}","expose":true,"service":"deep360-saas","stack":"SyntaxError: Expected property name or '}' in JSON at position 1 (line 1 column 2)\n    at JSON.parse (<anonymous>)\n    at parse (/workspace/node_modules/body-parser/lib/types/json.js:92:19)\n    at /workspace/node_modules/body-parser/lib/read.js:128:18\n    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n    at invokeCallback (/workspace/node_modules/raw-body/index.js:238:16)\n    at done (/workspace/node_modules/raw-body/index.js:227:7)\n    at IncomingMessage.onEnd (/workspace/node_modules/raw-body/index.js:287:7)\n    at IncomingMessage.emit (node:events:518:28)\n    at endReadableNT (node:internal/streams/readable:1698:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)","status":400,"statusCode":400,"timestamp":"2025-08-09T19:52:17.401Z","type":"entity.parse.failed"}
error: 服务器错误: Expected property name or '}' in JSON at position 1 (line 1 column 2) {"body":"{email:test@example.com,password:password123}","expose":true,"service":"deep360-saas","stack":"SyntaxError: Expected property name or '}' in JSON at position 1 (line 1 column 2)\n    at JSON.parse (<anonymous>)\n    at parse (/workspace/node_modules/body-parser/lib/types/json.js:92:19)\n    at /workspace/node_modules/body-parser/lib/read.js:128:18\n    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n    at invokeCallback (/workspace/node_modules/raw-body/index.js:238:16)\n    at done (/workspace/node_modules/raw-body/index.js:227:7)\n    at IncomingMessage.onEnd (/workspace/node_modules/raw-body/index.js:287:7)\n    at IncomingMessage.emit (node:events:518:28)\n    at endReadableNT (node:internal/streams/readable:1698:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)","status":400,"statusCode":400,"timestamp":"2025-08-09T19:52:36.166Z","type":"entity.parse.failed"}
info: 队列统计: {"ai_content":{"active":0,"completed":0,"failed":0,"waiting":0},"auto_reply":{"active":0,"completed":0,"failed":0,"waiting":0},"bulk_message":{"active":0,"completed":0,"failed":0,"waiting":0},"contact_add":{"active":0,"completed":0,"failed":0,"waiting":0},"content_scrape":{"active":0,"completed":0,"failed":0,"waiting":0},"data_export":{"active":0,"completed":0,"failed":0,"waiting":0},"group_create":{"active":0,"completed":0,"failed":0,"waiting":0},"group_invite":{"active":0,"completed":0,"failed":0,"waiting":0},"group_kick":{"active":0,"completed":0,"failed":0,"waiting":0},"service":"deep360-saas","timestamp":"2025-08-09T19:52:48.244Z"}
